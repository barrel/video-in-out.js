(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports.default = function () {
  var o = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var listeners = {};

  var on = function on(e) {
    var cb = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

    if (!cb) return;
    listeners[e] = listeners[e] || { queue: [] };
    listeners[e].queue.push(cb);
  };

  var emit = function emit(e) {
    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

    var items = listeners[e] ? listeners[e].queue : false;
    items && items.forEach(function (i) {
      return i(data);
    });
  };

  return _extends({}, o, {
    emit: emit,
    on: on
  });
};

},{}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var requestFrame = window.requestAnimationFrame;
var cancelFrame = window.cancelAnimationFrame;
var scrollChanged = void 0,
    y = void 0,
    prevY = -1,
    idle = true,
    queue = [],
    timeout = void 0,
    tickId = void 0,
    init = false;

if (!requestFrame) {
  ['ms', 'moz', 'webkit', 'o'].every(function (prefix) {
    requestFrame = window[prefix + 'RequestAnimationFrame'];
    cancelFrame = window[prefix + 'CancelAnimationFrame'] || window[prefix + 'CancelRequestAnimationFrame'];
    return !requestFrame;
  });
}

var isSupported = !!requestFrame;

var enable = function enable() {
  window.addEventListener('scroll', debounce);
  document.body.addEventListener('touchmove', debounce);
};

var disable = function disable() {
  window.removeEventListener('scroll', debounce);
  document.body.removeEventListener('touchmove', debounce);
};

var debounce = function debounce() {
  if (!tickId) {
    disable();
    tick();
  }
};

var tick = function tick() {
  tickId = requestFrame(handleScroll);
};

var handleScroll = function handleScroll() {
  y = window.pageYOffset;
  queue.forEach(function (fn) {
    return fn(y, prevY);
  });

  scrollChanged = false;
  if (prevY != y) {
    scrollChanged = true;
    prevY = y;
  }

  if (scrollChanged) {
    clearTimeout(timeout);
    timeout = null;
  } else if (!timeout) {
    timeout = setTimeout(detectIdle, 200);
  }

  tick();
};

var detectIdle = function detectIdle() {
  cancelFrame(tickId);
  tickId = null;
  enable();
};

exports.default = function (cb) {
  if (isSupported) {
    queue.push(cb);
    if (!init) {
      init = true;
      debounce();
      enable();
    }
  } else {
    console.warn('Request Animation Frame not supported');
  }
};

},{}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _rafScroll = require('raf-scroll.js');

var _rafScroll2 = _interopRequireDefault(_rafScroll);

var _loop = require('loop.js');

var _loop2 = _interopRequireDefault(_loop);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var inViewport = function inViewport(el) {
  var rect = el.getBoundingClientRect();
  return rect.top < rect.height && rect.top + rect.height > 0;
};

var merge = function merge(defaults) {
  return function (overwrites) {
    Object.keys(overwrites).forEach(function (val) {
      defaults[val] = overwrites[val];
    });
    return defaults;
  };
};

var testState = function testState(el) {
  return el.readyState == 4;
};

var setSrc = function setSrc(el) {
  var intViewportWidth = window.innerWidth;
  var sources = el.getAttribute('data-src').split(', ').map(function (source) {
    return {
      src: source.split(' ').shift(),
      size: parseInt(source.split(' ').pop().split('x').shift())
    };
  }).filter(function (source) {
    if (intViewportWidth <= source.size) {
      return true;
    }
  });
  el.setAttribute('src', sources.pop().src);
};

var events = (0, _loop2.default)();

exports.default = function (el) {
  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var settings = merge({
    readyClass: 'video-ready',
    parentEl: el.parentNode,
    autoload: true,
    fadeIn: function fadeIn(el) {
      el.parentNode.classList.add('is-ready');
    }
  })(opts);

  var revealed = false;
  var ready = false;
  var paused = true;

  var play = function play() {
    paused = false;
    el.play();
    events.emit('play', el);
  };

  var pause = function pause() {
    paused = true;
    el.pause();
    events.emit('pause', el);
  };

  var setReady = function setReady(value) {
    if (!value) return;
    ready = value;

    if (inViewport(el)) play(el);
    if (!revealed) {
      revealed = true;
      events.emit('ready', el);
      settings.fadeIn(el);
    }
  };

  //Add src immediately
  if (settings.autoload) setSrc(el);

  (0, _rafScroll2.default)(function (y, prevY) {
    if (inViewport(el)) {
      if (!el.getAttribute('src')) {
        setSrc(el);
      }
      if (paused) play(el);
    } else {
      if (!paused) pause(el);
    }
  });

  el.addEventListener('canplaythrough', function () {
    setReady(testState(el));
  });

  setReady(testState(el));

  return {
    on: events.on,
    play: play,
    pause: pause,
    getReady: function getReady() {
      return ready;
    }
  };
};

},{"loop.js":1,"raf-scroll.js":2}],4:[function(require,module,exports){
'use strict';

var _main = require('./../src/main.js');

var _main2 = _interopRequireDefault(_main);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

document.addEventListener('DOMContentLoaded', function (e) {
  var videoEl = document.querySelector('video');
  var module = (0, _main2.default)(videoEl);
  module.on('ready', function () {
    return console.dir('ready');
  });
  module.on('pause', function () {
    return console.dir('pause');
  });
  module.on('play', function () {
    return console.dir('play');
  });
});

},{"./../src/main.js":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvbG9vcC5qcy9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9yYWYtc2Nyb2xsLmpzL3NyYy9tYWluLmpzIiwic3JjL21haW4uanMiLCJ0ZXN0L2Rldi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7O2tCQ0FlLFlBQVk7QUFBQSxNQUFYLENBQVcsdUVBQVAsRUFBTzs7QUFDekIsTUFBTSxZQUFZLEVBQWxCOztBQUVBLE1BQU0sS0FBSyxTQUFMLEVBQUssQ0FBQyxDQUFELEVBQWtCO0FBQUEsUUFBZCxFQUFjLHVFQUFULElBQVM7O0FBQzNCLFFBQUksQ0FBQyxFQUFMLEVBQVM7QUFDVCxjQUFVLENBQVYsSUFBZSxVQUFVLENBQVYsS0FBZ0IsRUFBRSxPQUFPLEVBQVQsRUFBL0I7QUFDQSxjQUFVLENBQVYsRUFBYSxLQUFiLENBQW1CLElBQW5CLENBQXdCLEVBQXhCO0FBQ0QsR0FKRDs7QUFNQSxNQUFNLE9BQU8sU0FBUCxJQUFPLENBQUMsQ0FBRCxFQUFvQjtBQUFBLFFBQWhCLElBQWdCLHVFQUFULElBQVM7O0FBQy9CLFFBQUksUUFBUSxVQUFVLENBQVYsSUFBZSxVQUFVLENBQVYsRUFBYSxLQUE1QixHQUFvQyxLQUFoRDtBQUNBLGFBQVMsTUFBTSxPQUFOLENBQWM7QUFBQSxhQUFLLEVBQUUsSUFBRixDQUFMO0FBQUEsS0FBZCxDQUFUO0FBQ0QsR0FIRDs7QUFLQSxzQkFDSyxDQURMO0FBRUUsY0FGRjtBQUdFO0FBSEY7QUFLRCxDOzs7Ozs7OztBQ25CRCxJQUFJLGVBQWUsT0FBTyxxQkFBMUI7QUFDQSxJQUFJLGNBQWUsT0FBTyxvQkFBMUI7QUFDQSxJQUFJLHNCQUFKO0FBQUEsSUFBbUIsVUFBbkI7QUFBQSxJQUFzQixRQUFRLENBQUMsQ0FBL0I7QUFBQSxJQUFrQyxPQUFPLElBQXpDO0FBQUEsSUFBK0MsUUFBUSxFQUF2RDtBQUFBLElB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QTtBQUVMLFVBRkssSUFBQTtBQUdMLFdBSEssS0FBQTtBQUlMLGNBQVUsU0FBQSxRQUFBLEdBQUE7QUFBQSxhQUFBLEtBQUE7QUFBQTtBQUpMLEdBQVA7Ozs7OztBQzVGRixJQUFBLFFBQUEsUUFBQSxrQkFBQSxDQUFBOzs7Ozs7OztBQUVBLFNBQUEsZ0JBQUEsQ0FBQSxrQkFBQSxFQUE4QyxVQUFBLENBQUEsRUFBSztBQUNqRCxNQUFNLFVBQVUsU0FBQSxhQUFBLENBQWhCLE9BQWdCLENBQWhCO0FBQ0EsTUFBTSxTQUFTLENBQUEsR0FBQSxPQUFBLE9BQUEsRUFBZixPQUFlLENBQWY7QUFDQSxTQUFBLEVBQUEsQ0FBQSxPQUFBLEVBQW1CLFlBQUE7QUFBQSxXQUFNLFFBQUEsR0FBQSxDQUFOLE9BQU0sQ0FBTjtBQUFuQixHQUFBO0FBQ0EsU0FBQSxFQUFBLENBQUEsT0FBQSxFQUFtQixZQUFBO0FBQUEsV0FBTSxRQUFBLEdBQUEsQ0FBTixPQUFNLENBQU47QUFBbkIsR0FBQTtBQUNBLFNBQUEsRUFBQSxDQUFBLE1BQUEsRUFBa0IsWUFBQTtBQUFBLFdBQU0sUUFBQSxHQUFBLENBQU4sTUFBTSxDQUFOO0FBQWxCLEdBQUE7QUFMRixDQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZXhwb3J0IGRlZmF1bHQgKG8gPSB7fSkgPT4ge1xuICBjb25zdCBsaXN0ZW5lcnMgPSB7fVxuXG4gIGNvbnN0IG9uID0gKGUsIGNiID0gbnVsbCkgPT4ge1xuICAgIGlmICghY2IpIHJldHVyblxuICAgIGxpc3RlbmVyc1tlXSA9IGxpc3RlbmVyc1tlXSB8fCB7IHF1ZXVlOiBbXSB9XG4gICAgbGlzdGVuZXJzW2VdLnF1ZXVlLnB1c2goY2IpXG4gIH1cblxuICBjb25zdCBlbWl0ID0gKGUsIGRhdGEgPSBudWxsKSA9PiB7XG4gICAgbGV0IGl0ZW1zID0gbGlzdGVuZXJzW2VdID8gbGlzdGVuZXJzW2VdLnF1ZXVlIDogZmFsc2VcbiAgICBpdGVtcyAmJiBpdGVtcy5mb3JFYWNoKGkgPT4gaShkYXRhKSlcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLi4ubyxcbiAgICBlbWl0LFxuICAgIG9uXG4gIH1cbn1cbiIsImxldCByZXF1ZXN0RnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lXG5sZXQgY2FuY2VsRnJhbWUgID0gd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lXG5sZXQgc2Nyb2xsQ2hhbmdlZCwgeSwgcHJldlkgPSAtMSwgaWRsZSA9IHRydWUsIHF1ZXVlID0gW10sIHRpbWVvdXQsIHRpY2tJZCwgaW5pdCA9IGZhbHNlXG5cbmlmICghcmVxdWVzdEZyYW1lKSB7XG4gIFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ10uZXZlcnkocHJlZml4ID0+IHtcbiAgICByZXF1ZXN0RnJhbWUgPSB3aW5kb3dbcHJlZml4ICsgJ1JlcXVlc3RBbmltYXRpb25GcmFtZSddO1xuICAgIGNhbmNlbEZyYW1lICA9IHdpbmRvd1twcmVmaXggKyAnQ2FuY2VsQW5pbWF0aW9uRnJhbWUnXSB8fFxuICAgICAgICAgICAgICAgICAgIHdpbmRvd1twcmVmaXggKyAnQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XG4gICAgcmV0dXJuICFyZXF1ZXN0RnJhbWU7XG4gIH0pXG59XG5cbmNvbnN0IGlzU3VwcG9ydGVkID0gISFyZXF1ZXN0RnJhbWVcblxuY29uc3QgZW5hYmxlID0gKCkgPT4ge1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZGVib3VuY2UpXG4gIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZGVib3VuY2UpXG59XG5cbmNvbnN0IGRpc2FibGUgPSAoKSA9PiB7XG4gIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBkZWJvdW5jZSlcbiAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBkZWJvdW5jZSlcbn1cblxuY29uc3QgZGVib3VuY2UgPSAoKSA9PiB7XG4gIGlmICghdGlja0lkKXtcbiAgICBkaXNhYmxlKClcbiAgICB0aWNrKClcbiAgfVxufVxuXG5jb25zdCB0aWNrID0gKCkgPT4ge1xuICB0aWNrSWQgPSByZXF1ZXN0RnJhbWUoaGFuZGxlU2Nyb2xsKVxufVxuXG5jb25zdCBoYW5kbGVTY3JvbGwgPSAoKSA9PiB7XG4gIHkgPSB3aW5kb3cucGFnZVlPZmZzZXRcbiAgcXVldWUuZm9yRWFjaCggZm4gPT4gZm4oeSwgcHJldlkpIClcblxuICBzY3JvbGxDaGFuZ2VkID0gZmFsc2VcbiAgaWYgKHByZXZZICE9IHkpe1xuICAgIHNjcm9sbENoYW5nZWQgPSB0cnVlXG4gICAgcHJldlkgPSB5XG4gIH1cblxuICBpZiAoc2Nyb2xsQ2hhbmdlZCl7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpXG4gICAgdGltZW91dCA9IG51bGxcbiAgfSBlbHNlIGlmICghdGltZW91dCl7XG4gICAgdGltZW91dCA9IHNldFRpbWVvdXQoZGV0ZWN0SWRsZSwgMjAwKVxuICB9XG5cbiAgdGljaygpXG59XG5cbmNvbnN0IGRldGVjdElkbGUgPSAoKSA9PiB7XG4gIGNhbmNlbEZyYW1lKHRpY2tJZClcbiAgdGlja0lkID0gbnVsbFxuICBlbmFibGUoKVxufVxuXG5leHBvcnQgZGVmYXVsdCBjYiA9PiB7XG4gIGlmIChpc1N1cHBvcnRlZCl7XG4gICAgcXVldWUucHVzaChjYilcbiAgICBpZiAoIWluaXQpe1xuICAgICAgaW5pdCA9IHRydWVcbiAgICAgIGRlYm91bmNlKClcbiAgICAgIGVuYWJsZSgpXG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybignUmVxdWVzdCBBbmltYXRpb24gRnJhbWUgbm90IHN1cHBvcnRlZCcpXG4gIH1cbn0iLCJpbXBvcnQgc2Nyb2xsIGZyb20gJ3JhZi1zY3JvbGwuanMnXG5pbXBvcnQgbG9vcCBmcm9tICdsb29wLmpzJ1xuXG5jb25zdCBpblZpZXdwb3J0ID0gZWwgPT4ge1xuIGxldCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiByZXR1cm4gKHJlY3QudG9wIDwgcmVjdC5oZWlnaHQpICYmIChyZWN0LnRvcCArIHJlY3QuaGVpZ2h0ID4gMClcbn1cblxuY29uc3QgbWVyZ2UgPSBkZWZhdWx0cyA9PiBvdmVyd3JpdGVzID0+IHtcbiAgT2JqZWN0LmtleXMob3ZlcndyaXRlcykuZm9yRWFjaCggdmFsID0+IHtcbiAgICBkZWZhdWx0c1t2YWxdID0gb3ZlcndyaXRlc1t2YWxdXG4gIH0pXG4gIHJldHVybiBkZWZhdWx0c1xufVxuXG5jb25zdCB0ZXN0U3RhdGUgPSBlbCA9PiBlbC5yZWFkeVN0YXRlID09IDRcblxuY29uc3Qgc2V0U3JjID0gZWwgPT4ge1xuICBsZXQgaW50Vmlld3BvcnRXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICBsZXQgc291cmNlcyA9IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKS5zcGxpdCgnLCAnKS5tYXAoKHNvdXJjZSkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBzcmM6IHNvdXJjZS5zcGxpdCgnICcpLnNoaWZ0KCksXG4gICAgICBzaXplOiBwYXJzZUludChzb3VyY2Uuc3BsaXQoJyAnKS5wb3AoKS5zcGxpdCgneCcpLnNoaWZ0KCkpXG4gICAgfVxuICB9KS5maWx0ZXIoKHNvdXJjZSkgPT4ge1xuICAgIGlmIChpbnRWaWV3cG9ydFdpZHRoIDw9IHNvdXJjZS5zaXplKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfSlcbiAgZWwuc2V0QXR0cmlidXRlKCdzcmMnLCBzb3VyY2VzLnBvcCgpLnNyYylcbn1cblxuY29uc3QgZXZlbnRzID0gbG9vcCgpXG5cbmV4cG9ydCBkZWZhdWx0IChlbCwgb3B0cz17fSkgPT4ge1xuICBjb25zdCBzZXR0aW5ncyA9IG1lcmdlKHtcbiAgICByZWFkeUNsYXNzOid2aWRlby1yZWFkeScsXG4gICAgcGFyZW50RWw6ZWwucGFyZW50Tm9kZSxcbiAgICBhdXRvbG9hZDp0cnVlLFxuICAgIGZhZGVJbjogZWwgPT4ge1xuICAgICAgZWwucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdpcy1yZWFkeScpXG4gICAgfVxuICB9KShvcHRzKVxuXG4gIGxldCByZXZlYWxlZCA9IGZhbHNlXG4gIGxldCByZWFkeSAgICA9IGZhbHNlXG4gIGxldCBwYXVzZWQgICA9IHRydWVcblxuICBsZXQgcGxheSA9ICgpID0+IHtcbiAgICBwYXVzZWQgPSBmYWxzZVxuICAgIGVsLnBsYXkoKVxuICAgIGV2ZW50cy5lbWl0KCdwbGF5JywgZWwpXG4gIH1cblxuICBsZXQgcGF1c2UgPSAoKSA9PiB7XG4gICAgcGF1c2VkID0gdHJ1ZVxuICAgIGVsLnBhdXNlKClcbiAgICBldmVudHMuZW1pdCgncGF1c2UnLCBlbClcbiAgfVxuXG4gIGxldCBzZXRSZWFkeSA9ICh2YWx1ZSkgPT4ge1xuICAgIGlmICghdmFsdWUpIHJldHVyblxuICAgIHJlYWR5ID0gdmFsdWVcblxuICAgIGlmICggaW5WaWV3cG9ydChlbCkgKSBwbGF5KGVsKVxuICAgIGlmICghcmV2ZWFsZWQpe1xuICAgICAgcmV2ZWFsZWQgPSB0cnVlXG4gICAgICBldmVudHMuZW1pdCgncmVhZHknLCBlbClcbiAgICAgIHNldHRpbmdzLmZhZGVJbihlbClcbiAgICB9XG4gIH1cblxuICAvL0FkZCBzcmMgaW1tZWRpYXRlbHlcbiAgaWYgKHNldHRpbmdzLmF1dG9sb2FkKSBzZXRTcmMoZWwpXG5cbiAgc2Nyb2xsKCAoeSwgcHJldlkpID0+IHtcbiAgICBpZiAoIGluVmlld3BvcnQoZWwpICl7XG4gICAgICBpZiAoICFlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpICl7XG4gICAgICAgIHNldFNyYyhlbClcbiAgICAgIH1cbiAgICAgIGlmIChwYXVzZWQpIHBsYXkoZWwpXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghcGF1c2VkKSBwYXVzZShlbClcbiAgICB9XG4gIH0pXG5cbiAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2FucGxheXRocm91Z2gnLCAoKSA9PiB7XG4gICAgc2V0UmVhZHkoIHRlc3RTdGF0ZShlbCkgKVxuICB9KVxuXG4gIHNldFJlYWR5KCB0ZXN0U3RhdGUoZWwpIClcblxuICByZXR1cm4ge1xuICAgIG9uOiBldmVudHMub24sXG4gICAgcGxheTpwbGF5LFxuICAgIHBhdXNlOnBhdXNlLFxuICAgIGdldFJlYWR5OiAoKSA9PiByZWFkeVxuICB9XG59XG4iLCJpbXBvcnQgdmlkZW8gZnJvbSAnLi8uLi9zcmMvbWFpbi5qcydcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGUgPT4ge1xuICBjb25zdCB2aWRlb0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndmlkZW8nKVxuICBjb25zdCBtb2R1bGUgPSB2aWRlbyh2aWRlb0VsKVxuICBtb2R1bGUub24oJ3JlYWR5JywgKCkgPT4gY29uc29sZS5kaXIoJ3JlYWR5JykpXG4gIG1vZHVsZS5vbigncGF1c2UnLCAoKSA9PiBjb25zb2xlLmRpcigncGF1c2UnKSlcbiAgbW9kdWxlLm9uKCdwbGF5JywgKCkgPT4gY29uc29sZS5kaXIoJ3BsYXknKSlcbn0pXG4iXX0=
